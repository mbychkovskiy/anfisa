apiVersion: apps/v1
kind: Deployment
metadata:
  name: anfisa-annotation-test
  labels:
    app: anfisa-annotation-test
spec:
  replicas: 1
  selector:
    matchLabels:
      app: anfisa-annotation-test
  template:
    metadata:
      labels:
        app: anfisa-annotation-test
    spec:
      securityContext:
        fsGroup: 999
        fsUser: 999
      initContainers:
        - name: anfisavepconfig-test
          image: "image-registry.openshift-image-registry.svc:5000/test/anfisa-annotation-test"
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          tty: true
          stdin: true
          command:
            - "entrypoint.sh"
          args:
            - "configurevep"
          serviceAccount: default
          volumeMounts:
          - name: anfisa-annotation-vep-cache-test
            mountPath: /opt/vep/.vep/
      containers:
        - name: anfisaannotation-test
          image: "image-registry.openshift-image-registry.svc:5000/test/anfisa-annotation-test"
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          tty: true
          stdin: true
          command:
            - "entrypoint.sh"
          args:
            - "astorage"
          serviceAccount: default
          volumeMounts:
          - name: anfisa-annotation-test
            mountPath: /data/project/AStorage/astorage.cfg
            subPath: astorage.cfg
          - name: anfisa-annotation-test
            mountPath: /data/project/AStorage/config.json
            subPath: config.json
          - name: anfisa-annotation-vep-cache-test
            mountPath: /opt/vep/.vep/
          - name: anfisa-annotation-data-test
            mountPath: /data/forannotation/
          - name: anfisa-annotation-db-test
            mountPath: /db/
      volumes:
      - name: anfisa-annotation-test
        configMap:
          name: anfisa-annotation-test
      - name: anfisa-annotation-vep-cache-test
        persistentVolumeClaim:
          claimName: asset-foromeannotation-pvc-test
      - name: anfisa-annotation-data-test
        persistentVolumeClaim:
          claimName: asset-foromeannotationdata-pvc-test
      - name: anfisa-annotation-db-test
        persistentVolumeClaim:
          claimName: asset-foromeannotationdb-pvc-test

      terminationGracePeriodSeconds: 5
